(()=>{"use strict";class e{constructor(){this.trello=document.querySelector(".trello")}saveCards(){const e=[],t=this.trello.querySelectorAll(".js-board");for(const a of t){let t=a.querySelectorAll(".js-card");const s=[];t.length>0&&(t=Array.from(t),t.forEach((e=>{s.push(e.querySelector(".js-card-text").textContent)}))),e.push(s)}localStorage.trelloUserContent=JSON.stringify(e)}extractCards(){if(!localStorage.trelloUserContent)return;const e=JSON.parse(localStorage.trelloUserContent),t=this.trello.querySelectorAll(".js-board");e.forEach(((e,a)=>{const s=t[a].querySelector(".js-cards");e.length>0&&e.forEach((e=>{const t=document.createElement("div");t.classList.add("trello__card","js-card"),t.innerHTML='<span class="trello__card-text js-card-text"></span>',t.querySelector(".js-card-text").textContent=e,s.append(t);const a=document.createElement("div");a.classList.add("trello__delete-card","js-delete-card"),a.innerHTML="<span> + </span>",t.append(a)}))}))}}class t{constructor(){this.localStorage=new e,this.trello=document.querySelector(".trello"),this.draggedCard=null,this.clonedCard=null,this.offsetCardClickX=null,this.offsetCardClickY=null,this.addEventsToBoards=this.addEventsToBoards.bind(this)}init(){this.localStorage.extractCards(),this.addEventsToBoards()}addEventsToBoards(){this.trello.addEventListener("click",(e=>{if(e.preventDefault(),e.target.classList.contains("js-add-textarea")){this.removeActiveTextarea(),this.hideAddCardPanel(),this.showAddCardPanel(e.target);const t=e.target.closest(".js-board").querySelector(".js-cards"),a=document.createElement("textarea");return a.classList.add("trello__textarea","js-textarea"),t.insertAdjacentElement("afterEnd",a),void a.focus()}if(e.target.classList.contains("js-add-card-button")){const t=e.target.closest(".js-board").querySelector(".js-textarea");if(""===t.value)return;const a=e.target.closest(".js-board").querySelector(".js-cards"),s=document.createElement("div");s.classList.add("trello__card","js-card"),s.innerHTML='<span class="trello__card-text js-card-text"></span>',s.querySelector(".js-card-text").textContent=t.value,a.append(s);const r=document.createElement("div");r.classList.add("trello__delete-card","js-delete-card"),r.innerHTML="<span> + </span>",s.append(r),this.localStorage.saveCards()}e.target.classList.contains("js-delete-card")&&(e.target.closest(".js-card").remove(),this.localStorage.saveCards()),e.target.classList.contains("js-textarea")||(this.removeActiveTextarea(),this.hideAddCardPanel())}));const e=document.querySelectorAll(".js-cards");for(const t of e)t.addEventListener("mousedown",(e=>{if(e.preventDefault(),!e.target.classList.contains("js-card"))return;document.body.classList.add("_grabbing"),this.draggedCard=e.target,this.clonedCard=e.target.cloneNode(!0),this.clonedCard.classList.add("_drag"),this.clonedCard.style.width=`${this.draggedCard.offsetWidth}px`,document.body.append(this.clonedCard),this.draggedCard.classList.add("_ghost");const t=this.draggedCard.getBoundingClientRect();this.offsetCardClickX=e.pageX-t.left,this.offsetCardClickY=e.pageY-t.top,this.positionsDraggedCard(e)}));this.trello.addEventListener("mousemove",(e=>{if(e.preventDefault(),this.draggedCard){if(this.positionsDraggedCard(e),e.target.classList.contains("js-card")){const t=e.target.getBoundingClientRect(),a=e.pageY-(t.bottom-t.height/2);return a<0&&e.target.insertAdjacentElement("beforeBegin",this.draggedCard),void(a>0&&e.target.insertAdjacentElement("afterEnd",this.draggedCard))}e.target.classList.contains("js-add-textarea")&&e.target.closest(".js-board").querySelector(".js-cards").append(this.draggedCard)}})),this.trello.addEventListener("mouseleave",(()=>{this.draggedCard&&(this.draggedCard&&this.draggedCard.classList.remove("_ghost"),this.dropGrabbingCard())})),this.trello.addEventListener("mouseup",(()=>{this.draggedCard&&(this.draggedCard&&(this.draggedCard.classList.remove("_ghost"),this.localStorage.saveCards()),this.dropGrabbingCard())}))}removeActiveTextarea(){const e=document.querySelector(".js-textarea");e&&e.remove()}hideAddCardPanel(){const e=document.querySelector(".js-add-textarea._hide"),t=document.querySelector(".js-add-card-button");e&&e.classList.remove("_hide"),t&&t.remove()}showAddCardPanel(e){e.classList.add("_hide");const t=e.closest(".js-board"),a=document.createElement("button");a.type="button",a.classList.add("trello__add-card-button","js-add-card-button"),a.textContent="Добавить карточку",t.insertAdjacentElement("beforeEnd",a)}positionsDraggedCard(e){this.clonedCard.style.left=e.pageX-this.offsetCardClickX+"px",this.clonedCard.style.top=e.pageY-this.offsetCardClickY+"px"}dropGrabbingCard(){document.body.classList.remove("_grabbing"),document.body.removeChild(this.clonedCard),this.draggedCard=null,this.clonedCard=null}}document.addEventListener("DOMContentLoaded",(()=>{(new t).init()}))})();